const compounds=[],turnDuration=7,primingTime=2e3,graceWindow=500,options={difficulty:1};let currentCard,i=0,currentTeam=-1,primed=!0;const turnScore={flops:[],ones:[],threes:[]},madScore={flops:0,ones:0,threes:0,adjustments:0},gladScore={flops:0,ones:0,threes:0,adjustments:0};function parseCSV(e,n){const t=e.split("\n"),r=t[0].split(",");t.slice(1).map((e=>{const t=e.split(","),o={};r.forEach(((e,n)=>{o[e]=t[n]})),n.push(o)}))}function shuffle(e){let n,t,r=e.length;for(;r>0;)n=Math.floor(Math.random()*r--),t=e[r],e[r]=e[n],e[n]=t}function advance(e){currentCard&&(tally(currentCard,e),currentCard=drawCard(),displayCard(currentCard))}function startTurn(){$(".start-turn").css("display","none"),primed=!1,turnScore.flops=[],turnScore.ones=[],turnScore.threes=[],$(".turn-tally .bucket div").remove(),$(".inner-bar").css("animation","timer 7s linear 0s none"),$("#draw-button").html("SKIP"),currentCard=drawCard(),displayCard(currentCard),setTimeout((()=>{currentTeam=-currentTeam,currentTeam<0?($(".mad").addClass("current"),$(".glad").removeClass("current"),gladScore.flops+=turnScore.flops.length,gladScore.ones+=turnScore.ones.length,gladScore.threes+=turnScore.threes.length):($(".glad").addClass("current"),$(".mad").removeClass("current"),madScore.flops+=turnScore.flops.length,madScore.ones+=turnScore.ones.length,madScore.threes+=turnScore.threes.length),updateScores(),setTimeout((()=>{currentCard=void 0,displayCard(currentCard),$(".inner-bar").css("animation","none"),$("#draw-button").html("GO"),$(".start-turn").css("display","block"),setTimeout((()=>{primed=!0}),2e3)}),500)}),7e3)}function updateScores(){let e=3*madScore.threes+madScore.ones-madScore.flops+madScore.adjustments,n=3*gladScore.threes+gladScore.ones-gladScore.flops+gladScore.adjustments;$(".mad .value").html(e),$(".glad .value").html(n)}function drawCard(){let e,n;for(;;)if(e=compounds[i++],"no"!==e.correctParse&&"1"!==e.isPlural&&"TRUE"!==e.profanity_stim&&!(0===options.difficulty&&"0"===e.isCommonstim||2===options.difficulty&&"1"===e.isCommonstim)){n=chooseConsituent(e);break}return[e,n]}function tally(e,n){let t=e[0],r=1===e[1]?`<div><span>${t.c1}</span>${t.c2}</div>`:`<div>${t.c1}<span>${t.c2}</span></div>`;switch(n){case-1:turnScore.flops.push(e),$(".turn-tally .flops").append(r);break;case 1:turnScore.ones.push(e),$(".turn-tally .ones").append(r);break;case 3:turnScore.threes.push(e),$(".turn-tally .threes").append(r)}}function displayCard(e){if(!e)return $("#constituent").html(""),void $("#compound").html("");let n=e[0],t=e[1],r=1===t?n.c1:n.c2;$("#constituent").html(r),$("#compound").html(n.stim),isCommonC=1===t?n.isCommonC1:n.isCommonC2,style1="1"===isCommonC?"none":"underline",style2="1"===n.isCommonstim?"none":"underline",$("#constituent").css("text-decoration",style1),$("#compound").css("text-decoration",style2)}function chooseConsituent(e){if("TRUE"===e.profanity_c1)return 2;if("TRUE"===e.profanity_c2)return 1;if(e.isCommonC1!==e.isCommonC2)return"1"===e.isCommonC1?1:2;let n=parseInt(e.nc1_cmpnoplural),t=parseInt(e.nc2_cmpnoplural);return n<t?1:t<n?2:Math.random()<.5?1:2}function changeDifficulty(){$('.menu-difficulty input[type="radio"]').change((function(){switch(this.value){case"easy":options.difficulty=0;break;case"medium":options.difficulty=1;break;case"hard":options.difficulty=2}$("body").css("background",undefined)}))}function changeBgColor(){$('.menu-bg-color input[type="radio"]').change((function(){let e;switch(this.value){case"yellow":e="rgb(254, 207, 83)";break;case"green":e="#87A96B";break;case"gray":e="#CACACA"}$("body").css("background",e)}))}$(document).ready((function(){parseCSV(LADEC,compounds),shuffle(compounds);compounds.length;$(".start-turn").on("click",(()=>{primed&&startTurn()})),$("#draw-button").on("click",(()=>advance(-1))),$(".card-top").on("click",(()=>advance(1))),$(".card-bottom").on("click",(()=>advance(3))),$(".mad .down").on("click",(()=>{--madScore.adjustments,updateScores()})),$(".mad .up").on("click",(()=>{++madScore.adjustments,updateScores()})),$(".glad .down").on("click",(()=>{--gladScore.adjustments,updateScores()})),$(".glad .up").on("click",(()=>{++gladScore.adjustments,updateScores()})),changeDifficulty(),changeBgColor()}));